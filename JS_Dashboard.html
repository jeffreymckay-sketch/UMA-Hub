<script>
/**
 * ===================================================================
 * DASHBOARD UI FUNCTIONS (CLEANED v3)
 * ===================================================================
 */

/**
 * Populates the dashboard content areas with data from the core load.
 * This is called by the main success handler in JS_Core.html.
 */
function populateDashboard(dashboardData) {
    if (!dashboardData) {
        console.error("populateDashboard was called with no data.");
        return;
    }

    const availabilityContainer = document.getElementById('my-availability-list');
    const preferencesContainer = document.getElementById('my-preferences-list');

    if (availabilityContainer) {
        renderAvailability(availabilityContainer, dashboardData.availability);
    } else {
        console.error("CRITICAL: Could not find element with ID 'my-availability-list' to render data.");
    }

    if (preferencesContainer) {
        renderPreferences(preferencesContainer, dashboardData.preferences);
    } else {
        console.error("CRITICAL: Could not find element with ID 'my-preferences-list' to render data.");
    }
}

/**
 * Renders the availability data into its container.
 */
function renderAvailability(container, data) {
    if (!container) return;

    if (!data || data.length === 0) {
        container.innerHTML = '<p class="not-available">No availability data has been recorded.</p>';
        return;
    }

    let content = '<table class="data-table zebra-stripes"><thead><tr><th>Day</th><th>Start Time</th><th>End Time</th><th></th></tr></thead><tbody>';
    data.forEach((row, index) => {
        // The row index from the original sheet is useful for delete operations.
        const originalRowIndex = row[row.length - 1]; 
        content += `<tr><td>${row[1]}</td><td>${row[2]}</td><td>${row[3]}</td><td><button class="button btn-sm danger" onclick="deleteAvailability(${originalRowIndex})">X</button></td></tr>`;
    });
    content += '</tbody></table>';
    container.innerHTML = content;
}

/**
 * Renders the preferences data into its container.
 */
function renderPreferences(container, data) {
    if (!container) return;

    if (!data || data.length === 0) {
        container.innerHTML = '<p class="not-available">No work preferences have been recorded.</p>';
        return;
    }
    
    let content = '<ul style="list-style:none; padding:0;">';
    data.forEach(row => {
        content += `<li style="margin-bottom:8px; padding:5px; background:#f1f1f1; border-radius:3px;"><strong>${row[1]}:</strong> ${row[2]}</li>`;
    });
    content += '</ul>';
    container.innerHTML = content;
}

</script>
