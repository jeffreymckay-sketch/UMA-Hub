<script>
/**
 * ===================================================================
 * DASHBOARD UI FUNCTIONS
 * ===================================================================
 */

/**
 * NEW: The missing orchestrator function.
 * This function is called by JS_Core.html after the initial data load.
 * It finds the correct containers and calls the rendering functions.
 */
function populateDashboard(dashboardData) {
    if (!dashboardData) {
        console.error("populateDashboard was called with no data.");
        return;
    }

    const availabilityContainer = document.getElementById('availability-container');
    const preferencesContainer = document.getElementById('preferences-container');

    if (availabilityContainer) {
        renderAvailability(availabilityContainer, dashboardData.availability);
    } else {
        console.warn("Could not find 'availability-container' to render data.");
    }

    if (preferencesContainer) {
        renderPreferences(preferencesContainer, dashboardData.preferences);
    } else {
        console.warn("Could not find 'preferences-container' to render data.");
    }
}

/**
 * This function is triggered when the dashboard page is navigated to.
 */
function load_dashboard() {
    showDashboardView('my-dashboard');
}

/**
 * Handles switching between the main dashboard view and the admin view.
 */
function showDashboardView(viewName) {
    document.getElementById('my-dashboard').style.display = 'none';
    document.getElementById('admin-dashboard').style.display = 'none';

    const view = document.getElementById(viewName);
    if (view) {
        view.style.display = 'block';
    }
}

/**
 * Renders the availability data into the specified container.
 */
function renderAvailability(container, data) {
    if (!container) return;

    if (!data || data.length === 0) {
        container.innerHTML = '<p class="not-available">No availability data has been recorded for the upcoming schedule.</p>';
        return;
    }

    // Create a more structured and readable table for availability
    let content = '<h5>Your Recorded Availability</h5><table class="data-table zebra-stripes"><thead><tr><th>Day</th><th>Start Time</th><th>End Time</th></tr></thead><tbody>';
    data.forEach(row => {
        // Assuming availability data is [StaffID, Day, Start, End]
        content += `<tr><td>${row[1]}</td><td>${row[2]}</td><td>${row[3]}</td></tr>`;
    });
    content += '</tbody></table>';
    container.innerHTML = content;
}

/**
 * Renders the preferences data into the specified container.
 */
function renderPreferences(container, data) {
    if (!container) return;

    if (!data || data.length === 0) {
        container.innerHTML = '<p class="not-available">No work preferences have been recorded.</p>';
        return;
    }
    
    // Create a simple list for preferences
    let content = '<h5>Your Work Preferences</h5><ul>';
    data.forEach(row => {
        // Assuming preference data is [StaffID, PreferenceType, Value]
        content += `<li><strong>${row[1]}:</strong> ${row[2]}</li>`;
    });
    content += '</ul>';
    container.innerHTML = content;
}

</script>
